// svg.import.js 0.16 - Copyright (c) 2014 Wout Fierens - Licensed under the MIT license
;(function(){var e,t,n;e=function(r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g;for(a=0,f=r.length;a<f;a++){d=r[a];v={};g=[];p=d.nodeName.toLowerCase();v=t(d);switch(p){case"rect":case"circle":case"ellipse":h=i[p](0,0);break;case"line":h=i.line(0,0,0,0);break;case"text":if(d.childNodes.length<2){h=i[p](d.textContent)}else{var y;h=null;for(l=0;l<d.childNodes.length;l++){y=d.childNodes[l];if(y.nodeName.toLowerCase()=="tspan"){if(h===null)h=i[p](y.textContent);else h.tspan(y.textContent).attr(t(y))}}}break;case"path":h=i.path(v["d"],true);break;case"polygon":case"polyline":h=i[p](v["points"]);break;case"image":h=i.image(v["xlink:href"]);break;case"g":case"svg":h=i[p=="g"?"group":"nested"]();e(d.childNodes,h,s+1,o,u);break;case"defs":e(d.childNodes,i.defs(),s+1,o,u);break;case"use":h=i.use();break;case"clippath":case"mask":h=i[p=="mask"?"mask":"clip"]();e(d.childNodes,h,s+1,o,u);break;case"lineargradient":case"radialgradient":h=i.defs().gradient(p.split("gradient")[0],function(e){for(var n=0;n<d.childNodes.length;n++){e.at({offset:0}).attr(t(d.childNodes[n])).style(d.childNodes[n].getAttribute("style"))}});break;case"#comment":case"#text":case"metadata":case"desc":break;default:console.log("SVG Import got unexpected type "+p,d);break}switch(p){case"circle":v.rx=v.r;v.ry=v.r;delete v.r;break}if(h){m=n(v.transform);delete v.transform;h.attr(v).transform(m);if(h.attr("id"))o.add(h.attr("id"),h,s==0);if(p=="text")h.rebuild();if(typeof u=="function")u.call(h)}}return i};t=function(e){var t,n=e.attributes||[],r={};for(t=n.length-1;t>=0;t--)r[n[t].nodeName]=n[t].nodeValue;if(typeof r.stroke!="undefined"&&typeof r["stroke-width"]=="undefined")r["stroke-width"]=1;return r};n=function(e){var t,n,r,i={},s=(e||"").match(/[A-Za-z]+\([^\)]+\)/g)||[],o=SVG.defaults.trans();for(t=s.length-1;t>=0;t--){n=s[t].match(/([A-Za-z]+)\(([^\)]+)\)/);r=(n[2]||"").replace(/^\s+/,"").replace(/,/g," ").replace(/\s+/g," ").split(" ");switch(n[1]){case"matrix":i.a=SVG.regex.isNumber.test(r[0])?parseFloat(r[0]):o.a;i.b=parseFloat(r[1])||o.b;i.c=parseFloat(r[2])||o.c;i.d=SVG.regex.isNumber.test(r[3])?parseFloat(r[3]):o.d;i.e=parseFloat(r[4])||o.e;i.f=parseFloat(r[5])||o.f;break;case"rotate":i.rotation=parseFloat(r[0])||o.rotation;i.cx=parseFloat(r[1])||o.cx;i.cy=parseFloat(r[2])||o.cy;break;case"scale":i.scaleX=SVG.regex.isNumber.test(r[0])?parseFloat(r[0]):o.scaleX;i.scaleY=SVG.regex.isNumber.test(r[1])?parseFloat(r[1]):o.scaleY;break;case"skewX":i.skewX=parseFloat(r[0])||o.skewX;break;case"skewY":i.skewY=parseFloat(r[0])||o.skewY;break;case"translate":i.x=parseFloat(r[0])||o.x;i.y=parseFloat(r[1])||o.y;break}}return i};SVG.extend(SVG.Container,{svg:function(t,n){var r=document.createElement("div"),i=new SVG.ImportStore;r.innerHTML=t.replace(/\n/,"").replace(/<(\w+)([^<]+?)\/>/g,"<$1$2></$1>");e(r.childNodes,this,0,i,n);r=null;return i}});SVG.ImportStore=function(){this._importStoreRoots=new SVG.Set;this._importStore={}};SVG.extend(SVG.ImportStore,{add:function(e,t,n){this[e]=t;if(e){if(this._importStore[e]){var r=e;e+=Math.round(Math.random()*1e16);console.warn('Encountered duplicate id "'+r+'". Changed store key to "'+e+'".')}this._importStore[e]=t}if(n===true)this._importStoreRoots.add(t);return this},roots:function(e){if(typeof e=="function"){this._importStoreRoots.each(e);return this}else{return this._importStoreRoots.valueOf()}},get:function(e){return this._importStore[e]},remove:function(){return this.roots(function(){this.remove()})}})}).call(this);